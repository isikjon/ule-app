{% extends "base.html" %}

{% block content %}
<div class="min-h-screen bg-gradient-to-br from-green-50 to-blue-50 pb-20">
    <!-- Header -->
    <div class="bg-white shadow-sm border-b border-gray-100">
        <div class="max-w-4xl mx-auto px-4 py-6">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <img src="https://wazir.kg/static/ule.jpg" alt="ULE Logo" class="w-10 h-10 rounded-full shadow-lg">
                    <div>
                        <h1 class="text-xl font-bold text-gray-800">ULE Platform</h1>
                        <p class="text-sm text-gray-500">Добро пожаловать, <span id="userName" class="font-medium">Пользователь</span></p>
                    </div>
                </div>
                <button onclick="logout()" class="text-gray-500 hover:text-red-500 transition-colors">
                    <i class="fas fa-sign-out-alt text-lg"></i>
                </button>
            </div>
        </div>
    </div>
    
    <!-- Main Content -->
    <div class="max-w-4xl mx-auto px-4 py-8">
        <!-- Welcome Section -->
        <div class="bg-white rounded-2xl shadow-lg p-8 mb-8 text-center">
            <div class="w-20 h-20 bg-gradient-to-br from-green-500 to-blue-600 rounded-full flex items-center justify-center mx-auto mb-6">
                <i class="fas fa-home text-3xl text-white"></i>
            </div>
            <h2 class="text-2xl font-bold text-gray-800 mb-3">Добро пожаловать в ULE Platform!</h2>
            <p class="text-gray-600 mb-6">Выберите нужный раздел в нижней навигации для работы с платформой</p>
            
            <!-- Quick Stats -->
            <div class="grid grid-cols-3 gap-4">
                <div class="text-center">
                    <div class="text-2xl font-bold text-green-600" id="projectsCount">0</div>
                    <div class="text-sm text-gray-500">Проектов</div>
                </div>
                <div class="text-center">
                    <div class="text-2xl font-bold text-blue-600" id="responsesCount">0</div>
                    <div class="text-sm text-gray-500">Откликов</div>
                </div>
                <div class="text-center">
                    <div class="text-2xl font-bold text-purple-600" id="notificationsCount">0</div>
                    <div class="text-sm text-gray-500">Уведомлений</div>
                </div>
            </div>
            
            <!-- Quick Actions -->
            <div class="mt-8 grid grid-cols-2 gap-4">
                <a href="/my-skills" class="bg-green-500 hover:bg-green-600 text-white p-4 rounded-xl text-center transition-colors">
                    <i class="fas fa-tools text-2xl mb-2"></i>
                    <div class="font-semibold">Мои навыки</div>
                </a>
                <a href="/create-task" class="bg-blue-500 hover:bg-blue-600 text-white p-4 rounded-xl text-center transition-colors">
                    <i class="fas fa-plus text-2xl mb-2"></i>
                    <div class="font-semibold">Создать задачу</div>
                </a>
            </div>
        </div>
    </div>

    <!-- Bottom Navigation Bar -->
    <div class="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200">
        <div class="max-w-md mx-auto">
            <div class="flex justify-around items-center py-3">
                <a href="/search" class="flex flex-col items-center space-y-1">
                    <div class="w-6 h-6 border border-gray-400 rounded flex items-center justify-center">
                        <i class="ri-search-line text-gray-600 text-sm"></i>
                    </div>
                    <span class="text-xs text-gray-600">Поиск</span>
                </a>
                
                <a href="/create-task" class="w-12 h-12 bg-blue-500 rounded-full flex items-center justify-center shadow-lg">
                    <i class="ri-add-line text-white text-lg"></i>
                </a>
                
                <a href="/profile" class="flex flex-col items-center space-y-1">
                    <div class="w-6 h-6 border border-gray-400 rounded flex items-center justify-center">
                        <i class="ri-user-line text-gray-600 text-sm"></i>
                    </div>
                    <span class="text-xs text-gray-600">Профиль</span>
                </a>
            </div>
        </div>
    </div>
</div>

<script>
function logout() {
    localStorage.removeItem('auth_token');
    localStorage.removeItem('user_data');
    window.location.href = '/login';
}

document.addEventListener('DOMContentLoaded', function() {
    const token = localStorage.getItem('auth_token');
    if (!token) {
        window.location.href = '/login';
        return;
    }

    const userData = JSON.parse(localStorage.getItem('user_data') || '{}');
    
    if (userData.name) {
        document.getElementById('userName').textContent = userData.name;
    }

    // Load quick stats
    loadQuickStats();
});

async function loadQuickStats() {
    try {
        const token = localStorage.getItem('auth_token');
        if (!token) return;

        // Load projects count
        const projectsResponse = await fetch('/api/v1/tasks/tasks', {
            headers: { 'Authorization': `Bearer ${token}` }
        });
        if (projectsResponse.ok) {
            const projects = await projectsResponse.json();
            document.getElementById('projectsCount').textContent = projects.length;
        }

        // Load notifications count
        const notificationsResponse = await fetch('/api/v1/tasks/notifications', {
            headers: { 'Authorization': `Bearer ${token}` }
        });
        if (notificationsResponse.ok) {
            const notifications = await notificationsResponse.json();
            const unreadCount = notifications.filter(n => !n.read).length;
            document.getElementById('notificationsCount').textContent = unreadCount;
        }

        // For now, set responses count to 0 (would need a new endpoint)
        document.getElementById('responsesCount').textContent = '0';
    } catch (error) {
        console.error('Error loading stats:', error);
    }
}
</script>
{% endblock %}
